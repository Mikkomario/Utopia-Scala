# Utopia Vault Coder

## v1.11 (in development)
### Breaking changes
- Factory objects are now named "...DbFactory" instead of "...Factory"
- Database model factories no longer contain separate -attName and -column properties, 
  but individual properties that implicitly (or explicitly) convert to both
- Database model factories no longer contain a `factory` property
- Database models now extend **Storable** instead of **StorableWithFactory**
- Database models are now written into `database.storable` package instead of `database.model` package
- The input file no longer supports a class property
- A package property no longer supports an object as a value
### New features
- Added support for referencing other files as package content
- Added support for **Angle** data type
- Added writing of factory traits, which facilitate with-method creation
- Support for autogenerated withX(...) filter/access methods (see README for details)
- Sub-packaging may now be omitted for individual classes by specifying a sub-package of `"-"`

## v1.10.1 - 22.01.2024
This update contains some new data types, some bugfixes and some quality-of-life improvements.
### Bugfixes
- Fixed `.toModel` generation involving optional enumeration values
- Fixed generated Scala type of **DateRange**
- From model schema declaration now uses json value conversion in default value generation
### New features
- Added two new data types: **Vector2D** and **Distance** (from **Paradigm**) and **LatLong** (from **Terra**)
- You may now specify an extending upper length limit within the type declaration, e.g. by writing `"String(3-9)"`
- Added default database property (i.e. part) names for the pre-defined multi-column data types, 
  as well as support for default part names in custom data types
### Other changes
- Setting `"crop": true` to a property without a length limit now sets the column length rule to `"crop"`
- Supports **Vault v1.18**

## v1.10 - 27.09.2023
This update introduces better json support, as well as many new data types.
### Breaking Changes
- Updated json conversion to convert certain data types (**FiniteDuration** & **Days**) using direct value conversions
- Sql column prefixes are no longer applied to json properties
- **Value** data type database model conversion now converts the value into json first
### Bugfixes
- Fixed a bug where function types using generic type parameters would not get 
  interpreted properly in the merging process
### New Features
- Added support for `no-combos` (`-NC`) argument/flag, which prevents the writing of any combo classes
  - This may be useful in situations where you only want to overwrite a single class and don't want to deal with 
    related class merge problems
- Added support for **Vector**, **Pair**, **Span**, **DateRange** and **Model** data types
- Standard and custom data types now support different from- & to-value conversion logic when dealing with json values
  - See README on how to apply this support to custom data types

## v1.9 - 01.05.2023
This update introduces a lot of bugfixes, as well as more extensive code-generation. 
This update is intended to be used with **Vault v1.16** (or later).
### Bugfixes
- `.apply(...)` implementation in factory objects that use potentially failing value conversions is now fixed
- Fixed a bug where certain enumeration ids would be 0-based instead of 1-based
- Merging now preserves function overrides. I.e. methods with same name but different types of parameters are 
  considered different methods and not merged.
- Scala parser now properly handles functional types
- Fixed a bug where the scala parser would make functions abstract
- Line breaks within documentation elements are now properly handled in sql
- Fixed a bug where certain words ending with y would be pluralized incorrectly
### New Features
- Access sub-package name may now be customized (see README)
- Added support for `allow_crop` -property when defining class properties (see README)
- Generated UniqueXAccess traits now implement filtering
  - Also, generated single access root points provide a new utility function `.filterDistinct(Condition)`
### Other Changes
- Supports **Vault v1.16**
- Generated UniqueXAccess traits now extend **SingleChronoRowModelFactory** where appropriate
- Generated access traits now extends **NullDeprecatableView** or **TimeDeprecatableView**, where applicable
- Generated combined factory objects now extend **FromRowFactoryWithTimestamps** where appropriate
- Enumeration values are now listed in sql comments
- Rewrote sub-access and filtering implementations so that they're simpler
- The `+Repr` type parameter in ManyXAccessLike has no super type requirement anymore

## v1.8 - 02.02.2023
This version of the Vault Coder writes more code than the previous versions, potentially saving you some time 
during development. The biggest style change you need to be aware of is the introduction of sub-packaging in 
access packages. Besides that, you will mostly get bugfixes and more extensive code-generation.
### Breaking Changes
- Access traits and objects are now written in class-specific sub-packages
### Bugfixes
- Fixed enumeration auto-indexing from 0-based (v1.7 -specific bug) back to 1-based
- Fixed a bug where enumeration default values were not imported properly
- Merging now supports operators (e.g. `+`), whereas the earlier versions omitted them from merge results
- Merging now supports annotations (e.g. `@deprecated`), whereas earlier versions omitted them from merge results
- Functional parameters that accepted tuples were not parsed correctly when merging - fixed
### New Features
- Added a new application / mode that writes input model templates based on existing database structure 
  (see README for details)
- Added `-N` argument that disables merging
- Added access point -writing for combined models
- Added FromModelFactory -writing for the XData -classes (experimental)
### Other Changes
- Possibly combined model constructors now contain a default parameter value of None
### Known Bugs
- Merging misplaces type declarations and their documentation
- Merging removes method overrides
- Merging doesn't fully support functional types yet

## v1.7 - 02.10.2022
This relatively major update focuses on two completely new features:
1. Enumeration customization and
2. Markdown documentation generation

Beside these, there are some smaller style fixes.

Please note the **change in default json property naming style**, however, as that will most likely 
**break your projects** in unexpected ways if not acted upon.
### Breaking Changes
- The default naming style for json properties is now `camelCase` (previously was `underscore`)
- Description access point naming updated (see [Bugfixes]())
- Code which deals with optional enumeration values may be altered
### Bugfixes
- Description access point naming (e.g. "DbTestDescriptions") previously yielded duplicate object names (e.g. "DbTest"), 
  now contains the proper suffix "Descriptions"
### New Features
- Added support for complex enumerations, meaning
  - **Custom id name and data type** support
  - **Documentation** support
  - **Default value** support
- Added markdown **documentation** writing
- Documentation naming convention, i.e. naming convention for scaladoc and markdown (new), may now be altered
### Other Changes
- Factory implementations of `.fromValidatedModel(Model)` are now **protected** instead of public

## v1.6 - 18.08.2022
This update adds a number of new features, such as custom data type support and program settings saving. 
This version also utilizes **Flow** v1.16 **String** value change, modifying how strings are handled in database 
interactions.
### Breaking Changes
- String / Text data type is no longer wrapped in **Option** and defaults to an empty string
  - This update requires using of **Flow** v1.16, which alter string-to-value conversion
  - If you don't want the string to be empty by default (or ever), you may use the new nonEmptyString -data type
- Plural name combinations only pluralize the last part anymore. E.g. when the previous version would return 
  "instancesIds", the current version returns "instanceIds"
- Modified visibility writing logic in low merge priority -situations
### New Features
- Added support for custom data types (see README for details)
- Added support for multi-column data types, although no inbuilt multi-column data type exists at this time 
  (see README for details)
- Added support for imports within the property default declaration
- The application may now store project paths to a local file so that they don't need to be repeated every time 
  the program is used
- Added update time data type (i.e. updated)
- The application moves the last build results to a "last-build" -directory before exporting new files
- The root access points of multiple deprecatable items now include a `.includingHistory` -property
### Bugfixes
- Extending column length rules are now written as "to X" instead of "up to X"
- Fixed an interpretation bug when parsing generic type parameters
- Implicit values and functions are now preserved and written as implicit when merging
### Other
- A specified property default value may now automatically be applied to sql as well, under certain conditions
- Very long strings are now written as TEXT, MEDIUMTEXT or LONGTEXT in the database
- There may be some changes to the output code layout

## v1.5 - 06.06.2022
This update adds a number of quality improvements both to input and output. Various edge cases are also supported, 
such as customizing naming conventions and referring to custom column names. These are useful when dealing with 
databases that were not originally designed with the Vault Coder.
### Breaking Changes
- Autogenerated column names and json property names for duration type now contain `_minutes`, `_seconds` etc. suffix
- Autogenerated column names and json property names for enumeration types now contain `_id` suffix
- `"description_link"` in the model structure document is now considered to refer to a class property and not a column
  - This may cause different results in cases where custom table names were used alongside the `"described"` property
- Enumeration value properties now have sql type TINYINT instead of INT
- This version requires Vault v1.12.1
### New Features
- Added **ManyXAccessLike** -trait writing in cases where a class contains combinations and when specifically requested
- You can now list initially inserted instances in the model structure document (see README for details)
- You can now write property length limit rules, which will be collected to a separate document (see README for details)
- You can now customize column, table, property, etc. naming rules in the model declaration document 
  (see README for more details)
- You can now customize id column name
- You can now customize the name of the referenced column in the `ref` / `reference` property
- You can now customize `String` and `Int` type maximum length / size by writing it into parentheses after the type name
  - See README for more details
- You may now specify database name in the input document (see README for details)
- Combo models now support the `doc` property
### Other Changes
- Classes which specify a creation time property now include **ChronoRowFactoryView** in **ManyXAccess** parents
- Class and property names within the documentation now follow standard writing style. 
  E.g. "word of life" instead of "wordOfLife"
- Sql documents now contain group headers based on class package names
- Generated non-Scala documents now contain a version number in their file name (if version has been specified)
- java.* and scala.* imports are now within separate groups below the other imports

## v1.4 - 27.01.2022
This update contains a number of additions in various levels. Perhaps most importantly, this version of the Vault Coder 
supports Vault v1.12, which previous versions don't do.
### Scala
This module now uses Scala v2.13.7
### New Features
- Added **Value** data type
- Added support for root path aliases, which can be stored to config.json file in application directory
- Added `.deprecate()` -function to access points that support deprecation
- Added support for `version` -property in model document (will be added to `@since` scaladoc tag)
### Bugfixes
- A number of bugfixes to the merging process
- Optional enumeration properties now have the default value of None, like other optional properties
- Fixed an issue where **FiniteDuration** was not always properly imported when reading durations from values
### Other Changes
- Supports **Vault** v1.12
- Classes that use both deprecation and expiration now have a custom deprecation implementation
- Merge conflicts document now shows if the conflict appears in a low-priority function
- Writes a merge conflict in case new extensions are added, since those may cause unexpected side effects
- Property name is now used when interpreting property data type
- Code blocks may now be written in a more concise manner
- **Value** vectors are now converted to processed values using different code
- `@since` scaladoc tag is now formatted differently
- Written sql document now contains a header
- Classes are now ordered by package name in written sql document (still respecting references, however)
- Slightly modified property documentation styling in sql document writing

## v1.3 - 04.11.2021
This major update adds a number of new quite important features.  
Also, this version is compatible with the latest **Metropolis** (v2.0) and **Citadel** (v2.0) versions, 
when it comes to description handling.
### Breaking Changes
- **Citadel** & **Metropolis** features are now based on **Metropolis** v2.0 and **Citadel** v2.0 and will have 
  compatibility problems with earlier versions
- Property types may now specify a different plural property name when using the default name
### New Features
- Added merging feature (see README for details)
- Added support for divided module structure (e.g. **Metropolis** & **Citadel** -case)
- Added custom sql default value support (see README for details)
- Added enumeration referencing (see README for details)
### Bugfixes
- In many item access points, the setter property names are now in plural format to match the getter names
- **TimeUnit** and **FiniteDuration** are now properly imported in generated XData and XFactory files
### Other Changes
- An id-based subset view is now written even when the access point doesn't support descriptions
- Tables in the SQL document are now written in a specific order, making sure referenced tables are written 
  before referencing tables
- Initials used in SQL indices and constraints are now unique within the project
- Changed some property type default values without changing the meaning 
  (e.g. default of **LocalDate** is `Today` instead of `LocalDate.now()`)
- Some property types now provide a sql default

## v1.2 - 18.10.2021
This major update adds a number of new important features and bugfix (see details below). The program interface is 
also refactored, somewhat.
### Breaking Changes
- Updated how program arguments are handled and added some interactive elements to the application
- Access points, which targeted individual items based on their id are now written into separate files (DbSingleXAccess)
### New Features
- Added support for combined models (e.g. combining Foo and Bar classes to form FooWithBars)
- Added support for described classes (**Citadel**-specific feature)
- Added support for **Days** and **FiniteDuration** data types (both concrete and optional variants)
- Added custom indexing support (see README for details)
- The app can now write specific classes, packages or enumerations based on filtering applied on program use
- Written many model access points now override the `filter(Condition)` function
- Written Stored models now contain a property `access`, which points to their id-specific access point
### Bugfixes
- Optional references didn't work previously - now fixed
- Fixed a bug where SQL indices where written incorrectly
- Fixed a bug in DbModel / Factory writing where wrong property names were used
- Fixed a bug in some factory implementations where read values were not unwrapped correctly
  - Please note that as a side effect, **ValueUnwraps** are no longer used when parsing instance data from models
### Other Changes
- Instant default value is now `Now` instead of `Instant.now()`

## v1.1 - 3.10.2021
This is a major update to the **Vault Coder** utility application, making it actually usable in production use. 
Beside the important bugfixes, this update adds very useful features and utility updates: Enumerations and deprecation 
are now supported, automatic line splitting is added and the model structure document reading is now more flexible. 

Of course, this update is also important in the sense that the module / application name and function was changed 
so that **Citadel** module is no longer a requirement in the use cases, making this application more widely applicable.
### Breaking Changes
- Renamed this module to **Utopia Vault Coder** - Also renamed code occurrences and removed **Metropolis** dependencies
  - Because of this, the **Tables** object implementation is left partially open.
- Updated accepted command line arguments:
  - The first argument specifies the path common for both input and output
  - The second argument specifies input file location relative to the common path
  - The third argument specifies the output file location relative to the common path
### New Features
- Added support for enumerations (see README for more details)
- Added support for deprecation (deprecation data type)
- Class name can be parsed from associated table name (if specified)
- Property name can now be guessed based on its data type (E.g. creation time properties are named "created" by default)
- Property documentation can be generated automatically for some data types
- Added automated line splitting
- Supports a wider range of key names in the input json document (e.g. "props" in addition to "properties")
- Added support for @author scaladoc tag
### Bugfixes
- Autogenerated table names used to be in wrong casing (first character in upper case under some circumstances)
- Fixed some bugs that resulted in code with build errors (this version is better tested)
### Other Changes
- Supports latest **Flow** and **Vault** changes
- Supports abstract functions internally

## v1.0 - 4.9.2021
Initial release. See Readme.md for mode details.
